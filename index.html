<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Math Hands</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; background-color: #f0f4f8; margin: 0; padding: 10px; touch-action: manipulation; }
        #exercise { font-size: 50px; margin: 10px; font-weight: 800; color: #2c3e50; }
        
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); 
                   display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; }
        #start-btn { padding: 20px 40px; font-size: 30px; background: #3498db; color: white; border: none; border-radius: 50px; cursor: pointer; }

        .game-container { display: flex; justify-content: center; gap: 10px; margin-top: 5px; min-height: 210px; }
        .hand-wrapper { display: flex; flex-direction: column; align-items: center; }
        
        svg { width: 150px; height: 200px; transition: all 0.3s; touch-action: none; }
        .finger { fill: #ffdbac; stroke: #8d5524; stroke-width: 2; cursor: pointer; -webkit-tap-highlight-color: transparent; }
        .finger.counted { fill: #ffad60; }
        .palm { fill: #ffdbac; stroke: #8d5524; stroke-width: 2; cursor: pointer; -webkit-tap-highlight-color: transparent; }
        
        .finger-label { font-size: 24px; font-weight: bold; fill: #ffffff; pointer-events: none; text-shadow: 1px 1px 2px #000; }
        
        #options-container { display: flex; justify-content: center; flex-wrap: wrap; column-gap: 55px; row-gap: 20px; visibility: hidden; }
        .vehicle-btn { display: flex; flex-direction: column; align-items: center; background: white; border: 3px solid #3498db; 
                       border-radius: 15px; padding: 8px; width: 70px; -webkit-tap-highlight-color: transparent; transition: transform 0.1s; }
        .vehicle-btn:active { transform: scale(0.95); }
        .vehicle-btn .icon { font-size: 30px; }
        .vehicle-btn .num { font-size: 20px; font-weight: bold; }

        #message { font-size: 22px; color: #4CAF50; font-weight: bold; height: 30px; margin-top: 10px; }

        @media (min-width: 768px) {
            #exercise { font-size: 100px; }
            svg { width: 250px; height: 320px; }
            .game-container { gap: 80px; min-height: 330px; }
            .vehicle-btn { width: 120px; padding: 20px; }
            .vehicle-btn .icon { font-size: 50px; }
            .vehicle-btn .num { font-size: 32px; }
        }
    </style>
</head>
<body>

    <div id="overlay">
        <h1>Ready to Count?</h1>
        <button id="start-btn" onclick="startGame()">START GAME</button>
    </div>

    <div id="exercise">---</div>
    <div class="game-container">
        <div class="hand-wrapper"><svg id="leftHand" viewBox="0 0 200 250"></svg></div>
        <div class="hand-wrapper"><svg id="rightHand" viewBox="0 0 200 250"></svg></div>
    </div>
    <div id="message"></div>
    <div id="options-container"></div>

    <script>
        let num1 = 0, num2 = 0, globalCounter = 0, isTransitioning = false;
        
        // Expanded vehicles list
        const vehicles = [
            'ðŸš—', 'ðŸš•', 'ðŸš™', 'ðŸšŒ', 'ðŸŽï¸', 'ðŸš“', 'ðŸš‘', 'ðŸš’', 'ðŸšœ', 'ðŸš²', 'ðŸš‚', 'âœˆï¸', 'ðŸš€', 'ðŸš¢',
            'ðŸ›µ', 'ðŸï¸', 'ðŸ›º', 'ðŸš', 'ðŸ›¸', 'ðŸ›¶', 'â›µ', 'ðŸš¤', 'ðŸ›³ï¸', 'ðŸšš', 'ðŸš›', 'ðŸ›»', 'ðŸ›´', 'ðŸ›¹', 
            'ðŸš ', 'ðŸšŸ', 'ðŸš‹', 'ðŸ›°ï¸', 'ðŸ—ï¸', 'ðŸšœ', 'ðŸš†', 'ðŸš²', 'ðŸš', 'â›½'
        ];

        const fingerData = [{x:20,y:80,w:28,h:75},{x:55,y:30,w:28,h:95},{x:90,y:10,w:28,h:105},{x:125,y:30,w:28,h:95},{x:160,y:70,w:28,h:65}];

        function startGame() {
            document.getElementById('overlay').style.display = 'none';
            newGame();
        }

        function speak(text, callback) {
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(text);
            msg.lang = 'en-US';
            if (callback) msg.onend = callback;
            window.speechSynthesis.speak(msg);
        }

        function drawHand(handId, fingerCount, isLeftHand) {
            const svg = document.getElementById(handId);
            svg.innerHTML = '';
            if(fingerCount === 0) return;

            const palm = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            palm.setAttribute("x", "30"); palm.setAttribute("y", "120");
            palm.setAttribute("width", "140"); palm.setAttribute("height", "100");
            palm.setAttribute("rx", "20");
            palm.setAttribute("class", "palm");
            
            // Logic for whole hand click
            const handlePalm = () => countWholeHand(handId, fingerCount);
            palm.onclick = handlePalm;
            palm.ontouchstart = (e) => { e.preventDefault(); handlePalm(); };
            
            svg.appendChild(palm);

            for (let i = 0; i < 5; i++) {
                if (i < fingerCount) {
                    const f = fingerData[i];
                    const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                    rect.setAttribute("x", f.x); rect.setAttribute("y", f.y);
                    rect.setAttribute("width", f.w); rect.setAttribute("height", f.h);
                    rect.setAttribute("rx", "12");
                    rect.setAttribute("class", "finger");
                    
                    const handleFinger = (e) => { e.stopPropagation(); countSingleFinger(rect); };
                    rect.onclick = handleFinger;
                    rect.ontouchstart = (e) => { e.preventDefault(); handleFinger(e); };
                    
                    svg.appendChild(rect);
                }
            }
        }

        function countSingleFinger(rect, silent = false) {
            if (rect.classList.contains('counted') || isTransitioning) return;
            globalCounter++;
            rect.classList.add('counted');
            const svg = rect.parentNode;
            const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
            text.setAttribute("x", parseInt(rect.getAttribute("x")) + 7);
            text.setAttribute("y", parseInt(rect.getAttribute("y")) + 35);
            text.setAttribute("class", "finger-label");
            text.textContent = globalCounter;
            svg.appendChild(text);
            
            if (!silent) speak(globalCounter);
            if (globalCounter === (num1 + num2)) showOptions();
        }

        function countWholeHand(handId, count) {
            if (isTransitioning) return;
            const svg = document.getElementById(handId);
            const uncounted = svg.querySelectorAll('.finger:not(.counted)');
            
            if (uncounted.length > 0) {
                // Determine if we should say the hand total or current count
                // If it's the first hand, say its total.
                speak(count); 
                uncounted.forEach(f => countSingleFinger(f, true)); // 'true' makes it silent
            }
        }

        function showOptions() {
            document.getElementById('message').textContent = "Pick the vehicle!";
            const container = document.getElementById('options-container');
            container.style.visibility = 'visible';
            container.innerHTML = '';
            const correct = num1 + num2;
            let choices = new Set([correct]);
            while(choices.size < 4) choices.add(Math.floor(Math.random() * 10) + 1);

            [...choices].sort(() => Math.random() - 0.5).forEach(num => {
                const btn = document.createElement('div');
                btn.className = 'vehicle-btn';
                btn.innerHTML = `<span class="icon">${vehicles[Math.floor(Math.random() * vehicles.length)]}</span><span class="num">${num}</span>`;
                const handleSelect = () => selectChoice(num, btn);
                btn.onclick = handleSelect;
                btn.ontouchstart = (e) => { e.preventDefault(); handleSelect(); };
                container.appendChild(btn);
            });
        }

        function selectChoice(picked, element) {
            if (isTransitioning || element.style.pointerEvents === 'none') return;
            const correct = num1 + num2;
            if (picked === correct) {
                isTransitioning = true;
                speak(`Correct. ${num1} plus ${num2} is ${correct}`);
                element.style.borderColor = "#4CAF50";
                element.style.background = "#c8e6c9";
                setTimeout(newGame, 3000);
            } else {
                speak("Try again!");
                element.style.opacity = "0.3";
                element.style.pointerEvents = "none";
            }
        }

        function newGame() {
            isTransitioning = false;
            globalCounter = 0;
            document.getElementById('leftHand').innerHTML = '';
            document.getElementById('rightHand').innerHTML = '';
            document.getElementById('message').textContent = "";
            document.getElementById('options-container').style.visibility = 'hidden';

            num1 = Math.floor(Math.random() * 5) + 1;
            num2 = Math.floor(Math.random() * 5) + 1;

            document.getElementById('exercise').textContent = `${num1} + ${num2} = ?`;

            speak(`${num1} plus ${num2}`, () => {
                drawHand('leftHand', num1, true);
                drawHand('rightHand', num2, false);
                document.getElementById('message').textContent = "Count the fingers!";
            });
        }
    </script>
</body>
</html>